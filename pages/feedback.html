<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feedback Form - DeshDarshan</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous" />

  <!-- Font Awesome (latest version) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <!-- Project CSS -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/components.css" />
  <link rel="stylesheet" href="../css/feedback.css" />
  <link rel="stylesheet" href="../css/navbar.css" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/icons/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/icons/favicon/favicon-16x16.png">
  <link rel="shortcut icon" href="../assets/images/icons/favicon/favicon.ico">

</head>

<body>

  <div id="navbar-container"></div>

  <main class="main-content">
    <div class="container">
      <div class="form-card">
        <div class="form-header">
          <h1>Share Your Feedback</h1>
          <p class="form-subtitle">
            Your insights help us improve the DeshDarshan experience!
          </p>
        </div>

        <form id="feedbackForm" novalidate>
          <div class="form-group">
            <label for="name">Name *</label>
            <input type="text" id="name" name="name" placeholder="Enter your full name" required aria-required="true"/>
            <div class="error-message" id="nameError" aria-live="polite">Please enter your name</div>
          </div>

          <div class="form-group">
            <label for="email">Email ID *</label>
            <input type="email" id="email" name="email" placeholder="Enter your email address" required aria-required="true"/>
            <div class="error-message" id="emailError" aria-live="polite">Please enter a valid email</div>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" placeholder="Enter your phone number (91+)" />
            <div class="error-message" id="phoneError" aria-live="polite">Please enter a valid phone number</div>
          </div>

          <!-- Star Rating -->
          <div class="form-group">
            <label>Rate Your Experience *</label>
            <div id="starRating">
              <span data-rating="1" title="Terrible">‚òÖ</span>
              <span data-rating="2" title="Not Good">‚òÖ</span>
              <span data-rating="3" title="Average">‚òÖ</span>
              <span data-rating="4" title="Good">‚òÖ</span>
              <span data-rating="5" title="Amazing">‚òÖ</span>
            </div>
            <div class="error-message" id="ratingError" aria-live="polite">Please select a rating</div>
          </div>

          <div class="form-group">
            <label for="message">Your Feedback *</label>
            <textarea id="message" name="message"
              placeholder="Share your thoughts about your experience with DeshDarshan..." required aria-required="true"></textarea>
            <div class="error-message" id="messageError" aria-live="polite">Please enter your message</div>
          </div>

          <button type="submit" class="submit-btn">
            <span>Submit Feedback</span>
            <i class="fas fa-paper-plane"></i>
          </button>
        </form>
      </div>
    </div>
  </main>

  <!-- Success Popup -->
  <div class="popup-overlay" id="successPopup">
    <div class="popup">
      <div class="popup-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="popup-message">
        <h3>Thank You!</h3>
        <p>
          Your feedback adds warmth to our colorful yatra across India. Thank
          you for being part of it! üå∫‚ù§Ô∏è
        </p>
      </div>
      <button class="popup-close" onclick="closePopup()">Close</button>
    </div>
  </div>

  <canvas id="confetti-canvas" class="confetti-canvas"></canvas>

  <!-- Footer -->
  <footer id="footer">
    <!-- Keep your footer exactly the same as before -->
    ... (omitted for brevity, unchanged)
  </footer>

  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Navbar -->
  <script src="../js/navbar-loader.js"></script>
  <script src="./js/navbar.js"></script>

  <!-- Feedback Form & Star Rating JS -->
  <script>
    const form = document.getElementById("feedbackForm");
    const stars = document.querySelectorAll("#starRating span");
    let selectedRating = 0;

    stars.forEach((star) => {
      star.addEventListener("click", () => {
        selectedRating = parseInt(star.dataset.rating);
        updateStars();
        document.getElementById("ratingError").classList.remove("show");
      });
      star.addEventListener("mouseover", () => highlightStars(parseInt(star.dataset.rating)));
    });

    document.getElementById("starRating").addEventListener("mouseleave", () => highlightStars(selectedRating));

    function highlightStars(rating) {
      stars.forEach((star) => {
        star.classList.toggle("active", parseInt(star.dataset.rating) <= rating);
      });
    }

    function updateStars() {
      highlightStars(selectedRating);
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      let isValid = true;

      document.querySelectorAll(".error").forEach((el) => el.classList.remove("error"));
      document.querySelectorAll(".error-message").forEach((el) => el.classList.remove("show"));

      // Name
      const nameField = document.getElementById("name");
      if (!nameField.value.trim() || !/^[A-Za-z ]{3,}$/.test(nameField.value)) {
        showError(nameField, "Please enter a valid name (min 3 letters)");
        isValid = false;
      }

      // Email
      const emailField = document.getElementById("email");
      if (!emailField.value.trim() || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailField.value)) {
        showError(emailField, "Please enter a valid email address");
        isValid = false;
      }

      // Phone
      const phoneField = document.getElementById("phone");
      if (phoneField.value.trim() && !/^[+]?([0-9]{10,14})$/.test(phoneField.value)) {
        showError(phoneField, "Please enter a valid 10-digit phone number");
        isValid = false;
      }

      // Star Rating
      if (selectedRating === 0) {
        document.getElementById("ratingError").classList.add("show");
        isValid = false;
      }

      // Message
      const messageField = document.getElementById("message");
      if (!messageField.value.trim()) {
        showError(messageField, "Please enter your message");
        isValid = false;
      }

      if (isValid) showSuccessPopup();
      else {
        const firstError = document.querySelector(".error");
        if (firstError) firstError.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    });

    function showError(field, message) {
      field.classList.add("error");
      const errorElement = document.getElementById(field.id + "Error");
      errorElement.textContent = message;
      errorElement.classList.add("show");
    }

    const myCanvas = document.getElementById("confetti-canvas");
    const myConfetti = confetti.create(myCanvas, { resize: true });

    function showSuccessPopup() {
      const popup = document.getElementById("successPopup");
      popup.classList.add("show");
      myConfetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
      document.body.style.overflow = "hidden";
    }

    function closePopup() {
      const popup = document.getElementById("successPopup");
      popup.classList.remove("show");
      document.body.style.overflow = "auto";
      form.reset();
      selectedRating = 0;
      updateStars();
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && document.getElementById("successPopup").classList.contains("show")) closePopup();
    });

    document.querySelectorAll("input, textarea").forEach((field) => {
      field.addEventListener("input", function () {
        this.classList.remove("error");
        const errorElement = document.getElementById(this.id + "Error");
        if (errorElement) errorElement.classList.remove("show");
      });
    });
  </script>

  <!-- Star CSS -->
  <style>
    #starRating span {
      font-size: 28px;
      color: #ccc;
      cursor: pointer;
      transition: color 0.15s ease;
      user-select: none;
    }

    #starRating span.active {
      color: #f5c518;
    }
  </style>

</body>
</html>
